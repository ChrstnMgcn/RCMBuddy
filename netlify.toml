# The final, correct, and complete netlify.toml file

[build]
  publish = "public"
  functions = "netlify/functions"
  command = "# No build command needed"

# This plugin ensures your function dependencies from the root package.json are installed.
[[plugins]]
  package = "@netlify/plugin-functions-install-core"

# --- API Redirects ---
# These rules map frontend API calls (e.g., /api/register) to Netlify's deployed function paths.
# Netlify by default flattens functions in subdirectories by replacing '/' with '-' (e.g., user-auth/register.js becomes user-auth-register).

# User Authentication Functions
[[redirects]]
  from = "/api/register"
  to = "/.netlify/functions/user-auth-register"
  status = 200

[[redirects]]
  from = "/api/login"
  to = "/.netlify/functions/user-auth-login"
  status = 200

# Admin Functions
[[redirects]]
  from = "/api/admin/get-company-admin-data"
  to = "/.netlify/functions/admin-get-company-admin-data"
  status = 200

[[redirects]]
  from = "/api/admin/get-company-users"
  to = "/.netlify/functions/admin-get-company-users"
  status = 200

[[redirects]]
  from = "/api/admin/update-company-defaults"
  to = "/.netlify/functions/admin-update-company-defaults"
  status = 200

[[redirects]]
  from = "/api/admin/update-user-tools"
  to = "/.netlify/functions/admin-update-user-tools"
  status = 200

[[redirects]]
  from = "/api/admin/get-all-companies"
  to = "/.netlify/functions/admin-get-all-companies"
  status = 200

[[redirects]]
  from = "/api/admin/get-all-tools"
  to = "/.netlify/functions/admin-get-all-tools"
  status = 200

# File Management Functions
[[redirects]]
  from = "/api/delete-file"
  to = "/.netlify/functions/file-management-delete-file"
  status = 200

[[redirects]]
  from = "/api/get-file"
  to = "/.netlify/functions/file-management-get-file"
  status = 200

[[redirects]]
  from = "/api/list-files"
  to = "/.netlify/functions/file-management-list-files"
  status = 200

[[redirects]]
  from = "/api/upload-file"
  to = "/.netlify/functions/file-management-upload-file"
  status = 200

# Data Dictionary Functions
[[redirects]]
  from = "/api/delete-data-dictionary"
  to = "/.netlify/functions/data-dictionary-delete-data-dictionary"
  status = 200

[[redirects]]
  from = "/api/get-data-dictionary"
  to = "/.netlify/functions/data-dictionary-get-data-dictionary"
  status = 200

[[redirects]]
  from = "/api/list-data-dictionaries"
  to = "/.netlify/functions/data-dictionary-list-data-dictionaries"
  status = 200

[[redirects]]
  from = "/api/save-data-dictionary"
  to = "/.netlify/functions/data-dictionary-save-data-dictionary"
  status = 200

# Other Functions
[[redirects]]
  from = "/api/clean-excel"
  to = "/.netlify/functions/clean-excel" # This one is directly in netlify/functions
  status = 200

# The generic /api/* redirect has been removed in favor of explicit rules to avoid ambiguity.
