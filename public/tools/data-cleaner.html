<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Buddy - Data Cleaner</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light background */
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">
    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col sm:flex-row items-center justify-between">
            <h1 class="text-white text-3xl font-bold mb-2 sm:mb-0">Data Cleaner</h1>
            <nav>
                <ul class="flex space-x-4">
                    <li><a href="/dashboard.html" class="text-white hover:text-blue-200 transition duration-300">Dashboard</a></li>
                    <li><a href="/tools.html" class="text-white hover:text-blue-200 transition duration-300">Tools List</a></li>
                    <li><a href="#" id="profileLink" class="text-white hover:text-blue-200 transition duration-300">Profile</a></li>
                    <li><a href="#" id="logoutBtn" class="text-white hover:text-blue-200 transition duration-300 cursor-pointer">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
        <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8">
            <h2 class="text-2xl sm:text-3xl font-semibold text-center text-blue-700 mb-4">
                Clean Your Excel Data Automatically
            </h2>
            <p class="text-lg text-gray-700 text-center mb-6">
                Upload your Excel file to remove duplicates, fix common formatting errors, and standardize data.
            </p>

            <div class="max-w-xl mx-auto bg-blue-50 p-6 rounded-lg shadow-md border border-blue-200">
                <h3 class="text-xl font-bold text-blue-600 mb-4">Upload Your Excel File</h3>
                <form id="uploadForm" class="space-y-4">
                    <div>
                        <label for="excelFile" class="block text-sm font-medium text-gray-700">Select File (.xlsx, .xls)</label>
                        <input type="file" id="excelFile" name="excelFile" accept=".xlsx, .xls" required
                               class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="cleaningOptions" class="block text-sm font-medium text-gray-700">Cleaning Options:</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="removeDuplicates" name="options" type="checkbox" checked
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="removeDuplicates" class="ml-2 block text-sm text-gray-900">Remove Duplicate Rows</label>
                            </div>
                            <div class="flex items-center">
                                <input id="trimSpaces" name="options" type="checkbox" checked
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="trimSpaces" class="ml-2 block text-sm text-gray-900">Trim Extra Spaces</label>
                            </div>
                            <div class="flex items-center">
                                <input id="standardizeText" name="options" type="checkbox"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="standardizeText" class="ml-2 block text-sm text-gray-900">Standardize Text Case (e.g., Proper Case)</label>
                            </div>
                        </div>
                    </div>
                    <button type="submit" id="cleanButton"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:-translate-y-0.5">
                        Clean Data
                    </button>
                </form>

                <div id="statusMessage" class="mt-4 text-center text-gray-700 hidden"></div>
                <div id="downloadSection" class="mt-6 text-center hidden">
                    <p class="text-green-700 font-semibold mb-3">Data Cleaning Complete!</p>
                    <a id="downloadLink" href="#" download="cleaned_data.xlsx"
                       class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-0.5">
                        Download Cleaned File
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-4 mt-8">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 Excel Buddy. All rights reserved.
        </div>
    </footer>

    <script>
        // Check for JWT on page load to ensure user is authenticated
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = '/'; // Redirects to index.html
                return;
            }

            // Optional: Token validation on page load.
            try {
                const response = await fetch('/api/protected', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    localStorage.removeItem('jwtToken');
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Error verifying token on Data Cleaner page:', error);
                localStorage.removeItem('jwtToken');
                window.location.href = '/';
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('jwtToken');
            window.location.href = '/';
        });

        // Simple profile link placeholder
        document.getElementById('profileLink').addEventListener('click', (e) => {
            e.preventDefault();
            alert('This would navigate to a detailed user profile page.');
        });

        // --- Data Cleaner Tool Logic (Client-side Placeholder) ---
        const uploadForm = document.getElementById('uploadForm');
        const excelFile = document.getElementById('excelFile');
        const cleanButton = document.getElementById('cleanButton');
        const statusMessage = document.getElementById('statusMessage');
        const downloadSection = document.getElementById('downloadSection');
        const downloadLink = document.getElementById('downloadLink');

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            statusMessage.textContent = 'Processing your file... This may take a moment.';
            statusMessage.classList.remove('hidden', 'text-red-700', 'text-green-700');
            statusMessage.classList.add('text-gray-700');
            downloadSection.classList.add('hidden'); // Hide previous download link

            const file = excelFile.files[0];
            if (!file) {
                statusMessage.textContent = 'Please select an Excel file to upload.';
                statusMessage.classList.remove('text-gray-700');
                statusMessage.classList.add('text-red-700');
                return;
            }

            // In a real application, you would send this file to a Netlify Function.
            // Example: const formData = new FormData();
            // formData.append('excelFile', file);
            // formData.append('removeDuplicates', document.getElementById('removeDuplicates').checked);
            // formData.append('trimSpaces', document.getElementById('trimSpaces').checked);
            // formData.append('standardizeText', document.getElementById('standardizeText').checked);

            // Mocking an API call and response for demonstration
            console.log('Simulating file upload and cleaning for:', file.name);
            cleanButton.disabled = true; // Disable button during processing

            setTimeout(async () => {
                // Simulate successful processing
                const mockCleanedDataUrl = 'https://placehold.co/600x400/00FF00/FFFFFF?text=Cleaned_Excel_File'; // Placeholder for cleaned file
                
                statusMessage.textContent = 'File processed successfully!';
                statusMessage.classList.remove('text-gray-700');
                statusMessage.classList.add('text-green-700');
                
                downloadLink.href = mockCleanedDataUrl;
                downloadSection.classList.remove('hidden');
                
                cleanButton.disabled = false; // Re-enable button
            }, 3000); // Simulate 3 seconds of processing
        });
    </script>
</body>
</html>
