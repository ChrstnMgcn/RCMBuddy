<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Validate - MirraBuddy</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS for Validation Engine -->
    <link rel="stylesheet" href="/tools/validation-engine.css">
    <!-- XLSX library for client-side Excel file parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="flex flex-col min-h-screen text-gray-800">
    <!-- Header Section: Consistent navigation across the app -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg print-hidden">
        <div class="container mx-auto flex flex-col sm:flex-row items-center justify-between">
            <h1 class="text-white text-3xl font-bold mb-2 sm:mb-0">Excel Validate</h1>
            <nav>
                <ul class="flex space-x-4">
                    <li><a href="/dashboard.html" class="text-white hover:text-blue-200 transition duration-300">Dashboard</a></li>
                    <li><a href="/tools.html" class="text-white hover:text-blue-200 transition duration-300">Tools List</a></li>
                    <li><a href="/tools/data-cleaner.html" class="text-white hover:text-blue-200 transition duration-300">Data Cleaner</a></li>
                    <li><a href="/tools/validation-engine.html" class="text-white hover:text-blue-200 transition duration-300 active">Excel Validate</a></li>
                    <li><a href="#" id="profileLink" class="text-white hover:text-blue-200 transition duration-300">Profile</a></li>
                    <li><a href="#" id="logoutBtn" class="text-white hover:text-blue-200 transition duration-300 cursor-pointer">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Section: Central area for the tool's functionality -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
        <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8">
            <h2 class="text-2xl sm:text-3xl font-semibold text-center text-blue-700 mb-4">
                Validate Your Excel Data Against Custom Rules
            </h2>
            <p class="text-lg text-gray-700 text-center mb-6">
                Ensure the integrity and accuracy of your spreadsheets by setting up and running powerful validation rules.
            </p>
            <div class="max-w-xl mx-auto text-gray-600 text-base mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <p class="font-semibold text-gray-800 mb-2">About This Tool:</p>
                <p>The **Validation Engine** helps you define and enforce data quality standards for your Excel files. It performs a comprehensive analysis of your data to identify common issues such as blank cells, "NULL" string entries, and dates that fall in the future. Additionally, it identifies duplicate rows within your sheets, ensuring data uniqueness. You can selectively ignore ("override") specific column issues from the overall Pass/Fail calculation in the summary report. This tool is ideal for pre-processing data for analysis, reporting, or database imports, ensuring your datasets are clean and reliable.</p>
                <ul class="list-disc list-inside mt-3 ml-5">
                    <li>**Blank Cells:** Detects and counts empty cells.</li>
                    <li>**"NULL" Strings:** Flags cells containing the literal string "NULL" (case-insensitive).</li>
                    <li>**Future Dates:** Identifies dates that are set after today's date.</li>
                    <li>**Duplicate Rows:** Pinpoints entire rows that are identical, indicating redundant entries.</li>
                    <li>**Override Issues:** Allows you to exclude specific column issues from the final data quality score if they are intentional.</li>
                </ul>
                <p class="mt-3">Upload your file, review the real-time analysis results, override irrelevant issues, and generate a detailed summary report. You can then print the report or export it along with your original data to a new Excel file.</p>
            </div>

            <div class="max-w-xl mx-auto bg-green-50 p-6 rounded-lg shadow-md border border-green-200">
                <h3 class="text-xl font-bold text-green-600 mb-4">Upload File & Analyze</h3>
                <form id="analyzeForm" class="space-y-4">
                    <div>
                        <label for="excelFile" class="block text-sm font-medium text-gray-700">Select Excel or CSV File to Validate</label>
                        <input type="file" id="excelFile" accept=".xlsx, .xls, .csv" required
                               class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none focus:border-green-500">
                    </div>

                    {/* Data Dictionary Selection */}
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-lg font-bold text-gray-700 mb-2">Optional: Select a Data Dictionary</h4>
                        <p class="text-sm text-gray-600 mb-3">Choose an uploaded data dictionary to use its rules for validation.</p>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <select id="dataDictionarySelect" class="flex-grow p-2 border border-gray-300 rounded-lg bg-white focus:ring-blue-500 focus:border-blue-500">
                                <option value="">-- No Data Dictionary Selected --</option>
                                {/* Options will be loaded here by JavaScript */}
                            </select>
                            <button type="button" id="loadDataDictionaryBtn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition duration-300">Load Dictionary</button>
                        </div>
                        <div id="dataDictionaryStatus" class="mt-2 text-sm text-gray-600 hidden"></div>
                    </div>
                    {/* End Data Dictionary Selection */}

                    <button type="button" id="analyzeFileBtn" onclick="analyzeFile()"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:-translate-y-0.5">
                        Analyze File
                    </button>
                </form>

                <div class="loader" id="loader"></div>

                <div id="results" class="mt-8 hidden">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Analysis Results</h2>
                    <p id="fileName" class="text-gray-700 font-medium mb-4"></p>
                    <div id="overallCounts" class="bg-gray-100 p-4 rounded-lg shadow-inner mb-6">
                        <p id="totalBlankCellsDisplay" class="text-gray-800 text-base font-medium"></p>
                        <p id="totalNullCountDisplay" class="text-gray-800 text-base font-medium"></p>
                        <p id="totalFutureDatesDisplay" class="text-gray-800 text-base font-medium"></p>
                        <p id="totalDuplicateRowsDisplay" class="text-gray-800 text-base font-medium"></p>
                    </div>
                    <div id="sheetResults"></div>
                    <button id="generateSummaryBtn" onclick="generateSummaryReport()" class="mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition duration-300 hidden">View Summary Report</button>
                </div>
            </div>

            <div id="summaryReportContainer" class="content-box mt-8" style="display:none;">
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-4 mt-8 print-hidden">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 Excel Buddy. All rights reserved.
        </div>
    </footer>

    <!-- External JavaScript for Validation Engine Logic -->
    <script src="/tools/validation-engine.js"></script>
</body>
</html>
