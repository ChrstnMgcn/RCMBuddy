<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - RCM Buddy</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter (You might want to replace with a font similar to the example image) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General body and font styling */
        body {
            font-family: 'Inter', sans-serif; /* Keep Inter, or replace with a font from the example if identified */
            color: #212529; /* Default text color */
            /* Background image and styling for the entire body */
            background-image: url('181603687.png'); /* Path to your background image */
            background-size: cover; /* Cover the entire viewport */
            background-position: center; /* Center the background image */
            background-repeat: no-repeat; /* Do not repeat the image */
            background-attachment: fixed; /* Keep image fixed during scroll */
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Ensure body takes full viewport height */
            overflow-x: hidden; /* Prevent horizontal scroll on small screens */
        }

        /* Header styling (consistent with other pages) */
        header {
            @apply bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg;
        }
        /* Ensure navigation links in the header are visible */
        header nav ul li a {
            color: white !important; /* Force text to be white */
            padding: 8px 12px; /* Add padding for better click area */
            border-radius: 6px; /* Slightly rounded corners */
        }
        header nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.1); /* Subtle hover background */
            color: #bfdbfe !important; /* Tailwind's blue-200 equivalent */
        }
        header nav ul li a.active {
            font-weight: 700; /* Bold for active link */
            background-color: rgba(255, 255, 255, 0.15); /* Slightly darker background for active */
        }

        /* Main content area styling for the split layout */
        main {
            @apply flex-grow flex items-center justify-center p-4 sm:p-6 lg:p-8;
            /* Using flex instead of grid for simpler 50/50 split and responsiveness */
            position: relative; /* For pseudo-element overlay if needed below */
            z-index: 1;
        }

        /* Left section with welcome message and illustration */
        .left-panel {
            @apply hidden md:flex flex-col items-center justify-center p-8;
            /* md:flex makes it visible on medium screens and up */
            background-image: linear-gradient(to right, rgba(0, 75, 150, 0.7), rgba(0, 50, 100, 0.7)); /* Darker gradient for illustration background */
            flex: 1; /* Takes equal space with the right panel */
            max-width: 50%; /* Ensures 50% width on desktop */
            min-height: 80vh; /* Ensure it takes up vertical space */
            border-radius: 1rem; /* Rounded corners for the panel */
            color: white;
            text-align: center;
            position: relative; /* For positioning the image */
            overflow: hidden; /* Hide overflowing parts of the image */
        }
        .left-panel h2 {
            @apply text-4xl font-bold mb-4 z-10; /* Bring text above image */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* Add text shadow for readability */
        }
        .left-panel p {
            @apply text-xl mb-8 z-10;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .left-panel img {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%; /* Adjust size of the illustration */
            max-width: 500px;
            height: auto;
            opacity: 0.9; /* Slightly transparent to blend with background */
            z-index: 0; /* Place behind text */
        }

        /* Right section with login form */
        .right-panel {
            @apply flex flex-col items-center justify-center flex-1 p-8;
            max-width: 50%; /* Ensures 50% width on desktop */
            min-height: 80vh; /* Match height of left panel */
            border-radius: 1rem; /* Rounded corners for the panel */
            background-color: rgba(255, 255, 255, 0.95); /* Slightly transparent white for form background */
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); /* More prominent shadow */
        }


        /* Form container styling */
        .auth-container {
            @apply p-8 sm:p-10 rounded-xl max-w-md w-full;
            border: 1px solid theme('colors.gray.200'); /* Subtle border */
            /* Removed direct margin-top/bottom as it's handled by flex positioning in right-panel */
            box-shadow: none; /* Shadow handled by right-panel */
            background-color: transparent; /* Make it transparent to use right-panel background */
        }
        .auth-container h2 {
            @apply text-3xl font-bold text-center text-blue-700 mb-6;
        }
        .input-group {
            @apply relative mb-6; /* Margin between input groups */
        }
        .input-group input {
            @apply w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500;
            color: #212529; /* Ensure input text is dark and readable */
        }
        .input-group input::placeholder {
            color: #6c757d; /* Darker placeholder for better visibility */
            opacity: 1; /* Ensure full opacity */
        }
        .input-group svg {
            @apply absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400;
            width: 20px;
            height: 20px;
        }
        .auth-container button {
            @apply w-full py-3 px-4 rounded-lg text-lg font-semibold text-white transition duration-300 ease-in-out transform;
            display: flex; /* Use flex for button content alignment */
            align-items: center;
            justify-content: center;
        }
        .auth-container .primary-btn {
            @apply bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500;
        }
        .auth-container .secondary-btn {
            @apply bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400;
        }
        .auth-container .link {
            @apply text-blue-600 hover:text-blue-800 transition duration-300;
            font-weight: 500; /* Make the link slightly bolder */
        }
        .message-box {
            @apply p-3 text-center text-sm rounded-md mb-4;
        }
        .message-box.success {
            @apply bg-green-100 text-green-700 border border-green-200;
        }
        .message-box.error {
            @apply bg-red-100 text-red-700 border border-red-200;
        }
        .message-box.info {
            @apply bg-blue-100 text-blue-700 border border-blue-200;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .left-panel {
                display: none; /* Hide left panel on smaller screens */
            }
            .right-panel {
                max-width: 100%; /* Take full width */
                min-height: 85vh; /* Adjust height */
            }
            main {
                padding: 1rem;
            }
            .auth-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-white text-3xl font-bold">RCM Buddy</h1>
            <!-- The "Login" link from previous versions is removed as it's now part of the form's context -->
        </div>
    </header>

    <!-- Main Content Section - Split Layout -->
    <main class="container mx-auto">
        <div class="left-panel">
            <h2 class="text-white">Welcome to</h2>
            <p class="text-white text-5xl font-extrabold leading-tight">Claims Adjudication</p>
            <!-- Placeholder for your illustration -->
            <img src="https://placehold.co/500x300/ffffff/000000?text=Your+Illustration+Here" alt="Claims Adjudication Illustration">
            <!-- Replace the above with your actual image, e.g.:
            <img src="path/to/your/illustration.png" alt="Claims Adjudication Illustration">
            -->
        </div>

        <div class="right-panel">
            <div class="auth-container">
                <h2 id="authTitle">User Login</h2> <!-- Changed to "User Login" -->
                
                <div id="messageBox" class="message-box hidden" role="alert"></div>

                <form id="authForm" class="space-y-6">
                    <div class="input-group">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        <label for="username" class="sr-only">Username or Email</label>
                        <input type="text" id="username" placeholder="Username or Email" required autocomplete="username">
                    </div>
                    <div class="input-group">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v3h8z"></path></svg>
                        <label for="password" class="sr-only">Password</label>
                        <input type="password" id="password" placeholder="Password" required autocomplete="current-password">
                    </div>
                    
                    <div class="text-right text-sm mb-4">
                        <a href="#" class="link">Forgot Password?</a>
                    </div>

                    <button type="submit" id="submitBtn" class="primary-btn">
                        Login
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </button>
                </form>

                <p class="text-center text-sm text-gray-600 mt-6">
                    Don't have an account? <a href="#" id="toggleAuth" class="link">Register here</a>
                </p>
            </div>
        </div>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-4 mt-8">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 RCM Buddy. All rights reserved.
        </div>
    </footer>

    <script>
        // Authentication Logic for Login/Registration Page
        const authForm = document.getElementById('authForm');
        const authTitle = document.getElementById('authTitle');
        const toggleAuthBtn = document.getElementById('toggleAuth');
        const submitBtn = document.getElementById('submitBtn');
        const messageBox = document.getElementById('messageBox');
        let isLogin = true; // State to track if it's currently login or registration

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box ${type}`; // Reset classes and add new ones
            messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        // Toggles between Login and Registration forms
        toggleAuthBtn.addEventListener('click', (e) => {
            e.preventDefault();
            hideMessage();
            isLogin = !isLogin;
            if (isLogin) {
                authTitle.textContent = 'User Login';
                submitBtn.textContent = 'Login';
                toggleAuthBtn.textContent = 'Register here';
                // Remove email field if it was added for registration
                const emailInputGroup = document.getElementById('email-group');
                if (emailInputGroup) emailInputGroup.remove(); 
            } else {
                authTitle.textContent = 'User Registration';
                submitBtn.textContent = 'Register';
                toggleAuthBtn.textContent = 'Login here';
                // Add email field for registration
                const emailDiv = document.createElement('div');
                emailDiv.id = 'email-group';
                emailDiv.className = 'input-group';
                emailDiv.innerHTML = `<svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                      <label for="email" class="sr-only">Email</label>
                                      <input type="email" id="email" placeholder="Email" required autocomplete="email">`;
                authForm.insertBefore(emailDiv, document.getElementById('password').parentElement);
            }
        });

        // Handles form submission (Login or Registration)
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage();

            const usernameInput = document.getElementById('username').value.trim();
            const passwordInput = document.getElementById('password').value.trim();
            const emailInput = isLogin ? '' : document.getElementById('email')?.value.trim(); // Use optional chaining for email

            let endpoint = isLogin ? '/api/login' : '/api/register';
            let payload = { username: usernameInput, password: passwordInput };

            if (!isLogin) {
                if (!emailInput) {
                    showMessage('Please enter your email.', 'error');
                    return;
                }
                payload = { username: usernameInput, email: emailInput, password: passwordInput, companyName: "Default Company" }; 
            }

            try {
                submitBtn.disabled = true; // Disable button during submission
                submitBtn.textContent = isLogin ? 'Logging in...' : 'Registering...';
                if (!isLogin) { // Add spinner for registration button
                    submitBtn.innerHTML = `
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Registering...
                    `;
                } else { // Add spinner for login button
                     submitBtn.innerHTML = `
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Logging in...
                    `;
                }


                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (response.ok) {
                    if (isLogin) {
                        localStorage.setItem('jwtToken', data.token);
                        showMessage('Login successful! Redirecting...', 'success');
                        setTimeout(() => {
                            window.location.href = '/dashboard.html'; // Redirect to dashboard
                        }, 1000);
                    } else {
                        showMessage('Registration successful! Please login.', 'success');
                        // Automatically switch to login form after successful registration
                        isLogin = true;
                        authTitle.textContent = 'User Login';
                        submitBtn.textContent = 'Login';
                        submitBtn.innerHTML = `
                            Login
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        `;
                        toggleAuthBtn.textContent = 'Register here';
                        const emailInputGroup = document.getElementById('email-group');
                        if (emailInputGroup) emailInputGroup.remove();
                    }
                } else {
                    showMessage(data.message || `Error: ${response.statusText}`, 'error');
                }
            } catch (error) {
                console.error('Network or server error:', error);
                showMessage('Network error. Please try again later.', 'error');
            } finally {
                submitBtn.disabled = false;
                // Restore button text if it was showing a spinner and not redirected
                if (!isLogin && submitBtn.textContent !== 'Register') {
                     submitBtn.innerHTML = `
                        Register
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    `;
                } else if (isLogin && submitBtn.textContent !== 'Login') {
                     submitBtn.innerHTML = `
                        Login
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    `;
                }
            }
        });

        // Check for existing token on page load to potentially redirect
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                // Attempt to verify token silently
                fetch('/api/protected', {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Token invalid or expired');
                    }
                })
                .then(data => {
                    // Token is valid, redirect to dashboard
                    console.log('Token still valid. Redirecting to dashboard.');
                    window.location.href = '/dashboard.html';
                })
                .catch(error => {
                    // Token invalid, expired, or network error. Clear token and stay on login.
                    console.error('Silent token verification failed:', error);
                    localStorage.removeItem('jwtToken');
                    showMessage('Your session has expired. Please log in again.', 'info');
                });
            }
        });
    </script>
</body>
</html>
