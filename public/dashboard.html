<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - RCM Buddy</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General body and font styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light background */
            color: #212529; /* Default text color */
        }
        /* Header styling (consistent with other pages) */
        header {
            @apply bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg;
        }
        /* Main content area styling */
        main {
            @apply flex-grow container mx-auto p-4 sm:p-6 lg:p-8;
        }
        /* Section styling for the main content block */
        section {
            @apply bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8;
        }
        /* Styles for individual tool cards on the dashboard */
        .tool-card {
            @apply p-6 rounded-lg shadow-md border transform hover:scale-105 transition-transform duration-300;
            display: flex; /* Use flexbox for better alignment of content */
            flex-direction: column; /* Stack content vertically */
            justify-content: space-between; /* Push launch button to bottom */
        }
        .tool-card h3 {
            @apply text-xl font-bold mb-3;
        }
        .tool-card p {
            @apply text-gray-600 mb-4 flex-grow; /* flex-grow to push button down */
        }
        .tool-card a {
            @apply inline-block font-bold py-2 px-4 rounded-full transition duration-300 text-center;
            /* Default button text color will be white */
            color: white;
        }

        /* Specific color themes for each tool card */
        .tool-card.file-manager {
            border-color: theme('colors.blue.200');
            background-color: theme('colors.blue.50');
        }
        .tool-card.file-manager h3 { color: theme('colors.blue.600'); }
        .tool-card.file-manager a { background-color: theme('colors.blue.500'); }
        .tool-card.file-manager a:hover { background-color: theme('colors.blue.600'); }

        .tool-card.data-cleaner {
            border-color: theme('colors.indigo.200');
            background-color: theme('colors.indigo.50');
        }
        .tool-card.data-cleaner h3 { color: theme('colors.indigo.600'); }
        .tool-card.data-cleaner a { background-color: theme('colors.indigo.500'); }
        .tool-card.data-cleaner a:hover { background-color: theme('colors.indigo.600'); }

        .tool-card.validation-engine {
            border-color: theme('colors.green.200');
            background-color: theme('colors.green.50');
        }
        .tool-card.validation-engine h3 { color: theme('colors.green.600'); }
        .tool-card.validation-engine a { background-color: theme('colors.green.500'); }
        .tool-card.validation-engine a:hover { background-color: theme('colors.green.600'); }

        .tool-card.data-dictionary-builder {
            border-color: theme('colors.purple.200');
            background-color: theme('colors.purple.50');
        }
        .tool-card.data-dictionary-builder h3 { color: theme('colors.purple.600'); }
        .tool-card.data-dictionary-builder a { background-color: theme('colors.purple.500'); }
        .tool-card.data-dictionary-builder a:hover { background-color: theme('colors.purple.600'); }

        /* NEW: Tool Card for Universal Ticket Tracker */
        .tool-card.ticket-tracker {
            border-color: theme('colors.orange.200'); /* Using orange for contrast */
            background-color: theme('colors.orange.50');
        }
        .tool-card.ticket-tracker h3 { color: theme('colors.orange.600'); }
        .tool-card.ticket-tracker a { background-color: theme('colors.orange.500'); }
        .tool-card.ticket-tracker a:hover { background-color: theme('colors.orange.600'); }

        /* NEW: Tool Card for User Profile */
        .tool-card.user-profile {
            border-color: theme('colors.pink.200');
            background-color: theme('colors.pink.50');
        }
        .tool-card.user-profile h3 { color: theme('colors.pink.600'); }
        .tool-card.user-profile a { background-color: theme('colors.pink.500'); }
        .tool-card.user-profile a:hover { background-color: theme('colors.pink.600'); }


        /* Styles for tools marked as 'development' (Coming Soon) */
        .development-tool {
            display: none; /* Hides development tools completely */
            opacity: 0.7; /* Make it slightly faded */
            filter: grayscale(20%); /* Slight grayscale effect */
            position: relative;
            background-color: theme('colors.gray.100'); /* Lighter background for development tools */
            border-color: theme('colors.gray.300');
            pointer-events: none; /* Disable clicks on the entire card */
        }
        .development-tool h3, .development-tool p {
            color: theme('colors.gray.500'); /* Grey out text */
        }
        .development-tool a {
            display: none; /* Hide the "Launch Tool" button */
        }
        .development-tool span.inline-block {
            @apply text-sm text-gray-500 italic; /* Style the "Coming Soon" text */
            margin-top: auto; /* Push to bottom if flex-grow on p doesn't work */
        }
        .development-tool::after {
            content: "Coming Soon"; /* Visible label for development tools */
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ffc107; /* Amber/Yellow badge */
            color: #333;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* You can uncomment this if you want to completely hide development tools */
        /* .tool-card[data-status="development"] { display: none; } */
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col sm:flex-row items-center justify-between">
            <h1 class="text-white text-3xl font-bold mb-2 sm:mb-0">RCM Buddy Dashboard</h1>
            <nav>
                <ul class="flex space-x-4">
                    <li><a href="/dashboard.html" class="text-white hover:text-blue-200 transition duration-300 active">Dashboard</a></li>
                    <li><a href="/tools.html" class="text-white hover:text-blue-200 transition duration-300">All Tools</a></li>
                    <li><a href="/profile.html" id="profileLink" class="text-white hover:text-blue-200 transition duration-300">Profile</a></li>
                    <li><a href="#" id="logoutBtn" class="text-white hover:text-blue-200 transition duration-300 cursor-pointer">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
        <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8">
            <h2 class="text-2xl sm:text-3xl font-semibold text-center text-blue-700 mb-4">
                Welcome, <span id="usernameDisplay"></span>!
            </h2>
            <p class="text-lg text-gray-700 text-center mb-6">
                Your Company: <span id="actualCompanyName">Loading company data...</span>
            </p>

            <h3 class="text-xl sm:text-2xl font-semibold text-center text-gray-700 mb-6">
                Quick Access to Your Tools
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

                <!-- Tool Card: File Manager -->
                <div class="tool-card file-manager" data-status="ready">
                    <h3 class="text-xl font-bold text-blue-600 mb-3">File Manager</h3>
                    <p class="text-gray-600 mb-4">Upload, store, and manage your company's Excel files securely in the cloud.</p>
                    <a href="/file-manager.html" class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                        Launch Tool
                    </a>
                </div>

                <!-- Tool Card: Data Cleaner -->
                <div class="tool-card data-cleaner" data-status="ready">
                    <h3 class="text-xl font-bold text-indigo-600 mb-3">Data Cleaner</h3>
                    <p class="text-gray-600 mb-4">Automatically identify and remove duplicates, fix formatting issues, and standardize text across your Excel files.</p>
                    <a href="/tools/data-cleaner.html" class="inline-block bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                        Launch Tool
                    </a>
                </div>

                <!-- Tool Card: Validation Engine -->
                <div class="tool-card validation-engine" data-status="ready">
                    <h3 class="text-xl font-bold text-green-600 mb-3">Validation Engine</h3>
                    <p class="text-gray-600 mb-4">Set up custom validation rules to ensure data integrity and prevent errors in your spreadsheets.</p>
                    <a href="/tools/validation-engine.html" class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                        Launch Tool
                    </a>
                </div>

                <!-- NEW: Tool Card: Data Dictionary Builder -->
                <div class="tool-card data-dictionary-builder" data-status="ready">
                    <h3 class="text-xl font-bold text-purple-600 mb-3">Data Dictionary Builder</h3>
                    <p class="text-gray-600 mb-4">Create and manage custom data dictionaries to define validation rules for your columns.</p>
                    <a href="/tools/data-dictionary-builder.html" class="inline-block bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                        Build Dictionary
                    </a>
                </div>

                <!-- NEW: Tool Card: Universal Ticket Tracker -->
                <div class="tool-card ticket-tracker" data-status="ready">
                    <h3 class="text-xl font-bold text-orange-600 mb-3">Universal Ticket Tracker</h3>
                    <p class="text-gray-600 mb-4">Upload and visualize your ticket data from any Excel report with dynamic filtering and printing.</p>
                    <a href="/tools/ticket-tracker/ticket-tracker.html" class="inline-block bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                        Launch Tracker
                    </a>
                </div>

                <!-- NEW: Tool Card: User Profile -->
                <div class="tool-card user-profile" data-status="ready">
                    <h3 class="text-xl font-bold text-pink-600 mb-3">User Profile</h3>
                    <p class="text-gray-600 mb-4">View and manage your personal account details and settings.</p>
                    <a href="/profile.html" class="inline-block bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                        View Profile
                    </a>
                </div>

                <!-- Placeholder for future development tools (these are now hidden by CSS) -->
                <div class="tool-card development-tool" data-status="development">
                    <h3 class="text-xl font-bold text-gray-500 mb-3">Report Automator</h3>
                    <p class="text-gray-500 mb-4">Automate the generation and distribution of your routine Excel reports with custom templates.</p>
                    <span class="inline-block text-sm text-gray-500 italic">Coming Soon!</span>
                </div>
                <div class="tool-card development-tool" data-status="development">
                    <h3 class="text-xl font-bold text-gray-500 mb-3">Merger & Splitter</h3>
                    <p class="text-gray-500 mb-4">Efficiently combine multiple Excel files or split large spreadsheets into manageable parts.</p>
                    <span class="inline-block text-sm text-gray-500 italic">Coming Soon!</span>
                </div>
                <div class="tool-card development-tool" data-status="development">
                    <h3 class="text-xl font-bold text-gray-500 mb-3">Macro Recorder & Editor</h3>
                    <p class="text-gray-500 mb-4">Record your repetitive Excel actions and easily edit or share the generated VBA macros.</p>
                    <span class="inline-block text-sm text-gray-500 italic">Coming Soon!</span>
                </div>
                <div class="tool-card development-tool" data-status="development">
                    <h3 class="text-xl font-bold text-gray-500 mb-3">Custom Formula Builder</h3>
                    <p class="text-gray-500 mb-4">Create, save, and manage your own complex Excel formulas for re-use and efficiency.</p>
                    <span class="inline-block text-sm text-gray-500 italic">Coming Soon!</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-4 mt-8">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 RCM Buddy. All rights reserved.
        </div>
    </footer>

    <script>
        // Common authentication and navigation setup
        async function verifyAndSetupUser() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = '/'; // Redirect to login if no token
                return;
            }

            try {
                const response = await fetch('/api/protected', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    // Token invalid or expired, clear and redirect to login
                    console.error('Token verification failed:', response.statusText, response.status);
                    localStorage.removeItem('jwtToken');
                    window.location.href = '/';
                    return;
                }

                const userData = await response.json();
                console.log("User Data from /api/protected:", userData); // Log userData for inspection

                // Display user and company name
                document.getElementById('usernameDisplay').textContent = userData.user.username;
                // Correctly access company_name based on user's architecture description and recent fixes
                // Check if company_name is directly in userData or nested under userData.user
                if (userData.company_name) { // Prefer top-level if it exists
                    document.getElementById('actualCompanyName').textContent = userData.company_name;
                } else if (userData.user && userData.user.company_name) { // Fallback to nested
                    document.getElementById('actualCompanyName').textContent = userData.user.company_name;
                } else {
                    document.getElementById('actualCompanyName').textContent = 'N/A'; // Indicate if not found
                }


                // Set profile link text
                const profileLink = document.getElementById('profileLink');
                if (profileLink) {
                    profileLink.textContent = `Hello, ${userData.user.username}`;
                    profileLink.href = '/profile.html'; // Direct link to the new profile page
                }

            } catch (error) {
                // Network error, assume token issue or server unreachable
                console.error('Error verifying token or fetching user data:', error);
                localStorage.removeItem('jwtToken');
                window.location.href = '/';
            }
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('jwtToken'); // Remove the JWT
            window.location.href = '/'; // Redirect to login page
        });

        // Initial load: Verify authentication and set up user info
        document.addEventListener('DOMContentLoaded', verifyAndSetupUser);
    </script>
</body>
</html>
